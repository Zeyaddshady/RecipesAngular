<div class="recipe-details">

  <!-- Image -->
  <img class="recipe-image" [src]="recipe.image" alt="Recipe Image" />

  <!-- Title + Rating + Meta -->
  <div class="header-row">
    <h1>{{ recipe.title }}</h1>

    <app-rating
      [(score)]="recipe.rating"
      (scoreChange)="onRatingChanged($event)"
    ></app-rating>
  </div>

  <p class="byline" *ngIf="author">
    Posted by
    <a [routerLink]="['/users', author.id]">
      {{ author.name }}
    </a>
  </p>

  <p class="meta">
    <span *ngIf="recipe.cuisine">{{ recipe.cuisine }}</span>
    <span *ngIf="recipe.cookTimeMinutes">
      · {{ recipe.cookTimeMinutes }} min
    </span>
    <span *ngIf="recipe.calories">
      · {{ recipe.calories }} kcal
    </span>
  </p>

  <!-- Description -->
  <p class="description">{{ recipe.description }}</p>

  <hr />

  <!-- Ingredients -->
  <h2>Ingredients</h2>
  <ul>
    <li *ngFor="let ing of recipe.ingredients">{{ ing }}</li>
  </ul>

  <hr />

  <!-- Steps -->
  <h2>Steps</h2>
  <ol>
    <li *ngFor="let step of recipe.steps">{{ step }}</li>
  </ol>

  <hr />

  <!-- Likes / Save -->
  <div class="actions-row">
    <button class="pill" (click)="toggleLike()">
      ❤️ {{ recipe.likes }} likes
    </button>
    <button class="pill" (click)="toggleSave()">
      {{ isSaved ? 'Saved' : 'Save for later' }}
    </button>
  </div>
  <hr />

  <!-- Comments -->
  <div class="comments-section">
    <h2>Comments</h2>
    <app-comment-input (submitComment)="onSubmitComment($event)"></app-comment-input>
    <app-comment-list [comments]="comments"></app-comment-list>
  </div>
  
  <hr />

  <!-- Reviews -->
  <div class="reviews-section">
    <h2>Reviews</h2>

    <div class="add-review">
      <label>Your rating</label>
      <app-rating [(score)]="newReviewRating"></app-rating>

      <label>Your review</label>
      <textarea [(ngModel)]="newReviewText" rows="3" placeholder="Share your experience..."></textarea>
      <div class="review-actions">
        <button class="primary" (click)="submitReview()">Submit review</button>
      </div>
    </div>

    <div class="reviews-list" *ngIf="reviews.length > 0; else noReviews">
      <div *ngFor="let r of reviews" class="review">
        <div class="review-header">
          <strong>{{ r.userName }}</strong>
          <app-rating [score]="r.rating"></app-rating>
        </div>
        <p class="review-text">{{ r.text }}</p>
        <small class="review-date">{{ r.createdAt | date:'short' }}</small>
      </div>
    </div>
    <ng-template #noReviews>
      <p>No reviews yet. Be the first to review this recipe.</p>
    </ng-template>
  </div>
</div>

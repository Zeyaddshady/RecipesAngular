<div class="profile-container" *ngIf="viewingUser as user; else noUserTpl">
  <div class="header">
    <div class="avatar" *ngIf="user.avatarUrl; else initials">
      <img [src]="user.avatarUrl" [alt]="user.name" />
    </div>
    <ng-template #initials>
      <div class="avatar initials">
        {{ user.name[0] }}
      </div>
    </ng-template>

    <div>
      <h2>{{ user.name }}</h2>
      <p class="email">{{ user.email }}</p>
      <p class="bio" *ngIf="user.bio">{{ user.bio }}</p>
      <button
        class="pill-button"
        *ngIf="!isOwnProfile"
        (click)="toggleFollow()"
      >
        {{ isFollowing ? 'Unfollow' : 'Follow' }}
      </button>
    </div>
  </div>

  <div class="stats">
    <div>
      <span class="number">{{ postedRecipes.length }}</span>
      <span class="label">Recipes</span>
    </div>
    <div>
      <span class="number">{{ followers.length }}</span>
      <span class="label">Followers</span>
    </div>
    <div>
      <span class="number">{{ following.length }}</span>
      <span class="label">Following</span>
    </div>
  </div>

  <!-- Tabs -->
  <div class="tabs">
    <button [class.active]="activeTab === 'recipes'" (click)="activeTab = 'recipes'">Recipes</button>
    <button [class.active]="activeTab === 'followers'" (click)="activeTab = 'followers'">Followers</button>
    <button [class.active]="activeTab === 'following'" (click)="activeTab = 'following'">Following</button>
    <button *ngIf="isOwnProfile" [class.active]="activeTab === 'saved'" (click)="activeTab = 'saved'">Saved</button>
  </div>

  <!-- Tab Content -->
  <div class="section" [ngSwitch]="activeTab">
    <!-- Posted Recipes -->
    <div *ngSwitchCase="'recipes'">
      <div class="cards" *ngIf="postedRecipes.length > 0; else noRecipes">
        <div class="card-wrapper" *ngFor="let r of postedRecipes">
          <a class="card-link" [routerLink]="['/recipes', r.id]">
            <app-recipe-card [recipe]="r"></app-recipe-card>
          </a>
          <button *ngIf="isOwnProfile" class="delete-button" (click)="deleteRecipe(r.id); $event.stopPropagation()">
            &times;
          </button>
        </div>
      </div>
      <ng-template #noRecipes>
        <p>This user hasn’t posted any recipes yet.</p>
      </ng-template>
    </div>

    <!-- Followers -->
    <div *ngSwitchCase="'followers'">
      <div class="user-list" *ngIf="followers.length > 0; else noFollowers">
        <a *ngFor="let follower of followers" [routerLink]="['/users', follower.id]" class="user-list-item">
          <img [src]="follower.avatarUrl" [alt]="follower.name" class="avatar-small" />
          <span>{{ follower.name }}</span>
        </a>
      </div>
      <ng-template #noFollowers>
        <p>This user has no followers yet.</p>
      </ng-template>
    </div>

    <!-- Following -->
    <div *ngSwitchCase="'following'">
      <div class="user-list" *ngIf="following.length > 0; else noFollowing">
        <a *ngFor="let followedUser of following" [routerLink]="['/users', followedUser.id]" class="user-list-item">
          <img [src]="followedUser.avatarUrl" [alt]="followedUser.name" class="avatar-small" />
          <span>{{ followedUser.name }}</span>
        </a>
      </div>
      <ng-template #noFollowing>
        <p>This user isn't following anyone yet.</p>
      </ng-template>
    </div>

    <!-- Saved Recipes -->
    <div *ngSwitchCase="'saved'">
      <div class="cards" *ngIf="savedRecipes.length > 0; else noSaved">
        <a class="card-link" *ngFor="let r of savedRecipes" [routerLink]="['/recipes', r.id]">
          <app-recipe-card [recipe]="r"></app-recipe-card>
        </a>
      </div>
      <ng-template #noSaved>
        <p>You haven’t saved any recipes yet.</p>
      </ng-template>
    </div>
  </div>
</div>

<ng-template #noUserTpl>
  <div class="profile-container">
    <p>User not found.</p>
  </div>
</ng-template>
